<!DOCTYPE html>

<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>GeoCalculator ‚Äî –ì–µ–æ–¥–µ–∑–∏—è</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root {
  --bg:        #0f0f14;
  --bg2:       #18181e;
  --surface:   #1f1f28;
  --surface2:  #25252e;
  --surface3:  #2a2a35;
  --border:    #2a2a35;
  --border2:   #35354a;
  --accent:    #6b7fd7;
  --accent2:   #5a6dc6;
  --accent3:   #8b9ce8;
  --gold:      #d89042;
  --green:     #3b9b6e;
  --red:       #c7556e;
  --text:      #dcdce4;
  --text-dim:  #70707e;
  --text-hi:   #f0f0f4;
  --glow:      none;
  --glow2:     none;
  --radius:    10px;
  --radius-sm: 6px;
  --font:      'Nunito', sans-serif;
  --mono:      'JetBrains Mono', monospace;
  --nav-h:     64px;
  --safe:      env(safe-area-inset-bottom, 0px);
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html,body{height:100%;overflow:hidden}
body{font-family:var(--font);background:var(--bg);color:var(--text);display:flex;flex-direction:column;overscroll-behavior:none}
body::after{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.02'/%3E%3C/svg%3E");background-size:200px;pointer-events:none;z-index:999;opacity:.3}

/* HEADER */
header{flex-shrink:0;height:60px;background:var(--bg2);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 18px;position:relative;z-index:100}
.logo{display:flex;align-items:center;gap:10px}
.logo-gem{width:36px;height:36px;background:var(--accent);border-radius:11px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.logo-gem svg{width:20px;height:20px}
.logo-name{font-size:20px;font-weight:800;color:var(--text-hi);letter-spacing:.5px;line-height:1.1}
.logo-name span{color:var(--accent)}
.logo-sub{font-size:9px;font-weight:400;color:var(--text-dim);letter-spacing:1.5px}
.header-pill{background:var(--surface2);border:1px solid var(--border);border-radius:20px;padding:5px 12px;font-family:var(--mono);font-size:10px;color:var(--accent);letter-spacing:.5px}

/* APP SCROLL */
.app{flex:1;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch;padding-bottom:calc(var(--nav-h) + var(--safe) + 16px)}
.app::-webkit-scrollbar{width:0}

/* PAGE */
.page{display:none;padding:16px 14px;animation:fadeUp .25s ease}
.page.active{display:block}
@keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

/* PAGE HEAD */
.page-head{margin-bottom:18px}
.page-title{font-size:24px;font-weight:800;color:var(--text-hi);line-height:1.15}
.page-title em{font-style:normal;color:var(--accent);}
.page-desc{font-size:13px;color:var(--text-dim);margin-top:4px;line-height:1.5}

/* CARD */
.card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-bottom:14px;position:relative;overflow:hidden}
.card::before{content:‚Äô‚Äô;position:absolute;top:0;left:0;right:0;height:2px;background:var(--accent);opacity:.6}
.card-title{font-size:12px;font-weight:700;color:var(--accent);letter-spacing:.8px;text-transform:uppercase;margin-bottom:14px;display:flex;align-items:center;gap:8px}
.ct-icon{width:26px;height:26px;background:var(--surface2);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:13px;flex-shrink:0}

/* FORM */
.field{margin-bottom:12px}
.field label{display:block;font-family:var(--mono);font-size:10px;color:var(--text-dim);letter-spacing:1px;text-transform:uppercase;margin-bottom:5px}
.field input,.field textarea,.field select{width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:var(--radius-sm);padding:12px 14px;font-family:var(--mono);font-size:14px;color:var(--text-hi);outline:none;transition:border-color .2s,box-shadow .2s;-webkit-appearance:none;appearance:none}
.field textarea{resize:none;min-height:100px;line-height:1.7}
.field input:focus,.field textarea:focus,.field select:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(107,127,215,.15)}
.field select{background-image:url("data:image/svg+xml,%3Csvg xmlns=‚Äòhttp://www.w3.org/2000/svg‚Äô width=‚Äò12‚Äô height=‚Äò8‚Äô viewBox=‚Äò0 0 12 8‚Äô%3E%3Cpath d=‚ÄòM1 1l5 5 5-5‚Äô stroke='%2370707e' stroke-width=‚Äò1.5‚Äô fill=‚Äònone‚Äô stroke-linecap=‚Äòround‚Äô/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;padding-right:36px}
.field-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
/* –ü–æ–ª–æ—Å—ã –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –ø–æ–ª–µ–π ‚Äî –≤ —Ç–æ–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É */
.field textarea::-webkit-scrollbar{width:8px}
.field textarea::-webkit-scrollbar-track{background:var(--surface);border-radius:4px}
.field textarea::-webkit-scrollbar-thumb{background:var(--border2);border-radius:4px}
.field textarea::-webkit-scrollbar-thumb:hover{background:var(--text-dim)}
.field textarea{scrollbar-color:var(--border2) var(--surface);scrollbar-width:thin}

/* BUTTONS */
.btn{font-family:var(--font);font-size:15px;font-weight:700;border:none;border-radius:var(--radius-sm);padding:14px 20px;cursor:pointer;transition:all .18s;width:100%;letter-spacing:.3px}
.btn-primary{background:var(--accent);color:#fff;}
.btn-primary:hover{background:var(--accent2);}
.btn-primary:active{transform:scale(.97);}
.btn-outline{background:var(--surface2);border:1px solid var(--border2);color:var(--text-dim)}
.btn-outline:active{background:var(--surface3)}
.btn-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:4px}

/* INFO */
.info{background:rgba(107,127,215,.08);border-left:3px solid var(--accent);border-radius:0 8px 8px 0;padding:10px 14px;font-size:12.5px;color:var(--text-dim);line-height:1.6;margin-bottom:14px}
.info strong{color:var(--text)}

/* RESULT */
.result{background:var(--surface2);border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-top:14px}
.result.hidden{display:none}
.result-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.ri-label{font-family:var(--mono);font-size:9px;letter-spacing:1.2px;text-transform:uppercase;color:var(--text-dim);margin-bottom:3px}
.ri-val{font-family:var(--mono);font-size:17px;font-weight:500;color:var(--accent);line-height:1.1}
.ri-val.p{color:var(--accent2)}.ri-val.g{color:var(--green)}.ri-val.o{color:var(--gold)}.ri-val.r{color:var(--red)}
.result-sep{height:1px;background:var(--border);margin:14px 0}
.result-formula{font-family:var(--mono);font-size:11px;color:var(--text-dim);line-height:1.9}
/* Collapsible annotations */
.ar-annot-wrap{margin-top:14px;border:1px solid var(--border);border-radius:var(--radius-sm);overflow:hidden}
.ar-annot-wrap details{border:none}
.ar-annot-wrap summary{font-size:12px;font-weight:700;color:var(--accent);padding:10px 14px;cursor:pointer;list-style:none;display:flex;align-items:center;gap:8px;background:var(--surface2);user-select:none}
.ar-annot-wrap summary::-webkit-details-marker{display:none}
.ar-annot-wrap summary::before{content:'';display:inline-block;width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top:6px solid currentColor;transition:transform .2s}
.ar-annot-wrap details[open] summary::before{transform:rotate(-90deg)}
.ar-annot-list{padding:8px 12px 12px}
.ar-annot-item{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm);padding:10px 12px;margin-bottom:8px;font-size:12px;line-height:1.5}
.ar-annot-item:last-child{margin-bottom:0}
.ar-annot-item strong{color:var(--text-hi);display:block;margin-bottom:4px;font-size:12.5px}
.ar-annot-f{font-family:var(--mono);font-size:11px;color:var(--accent2);margin-top:4px}
.ar-annot-why{color:var(--text-dim);margin-top:4px;font-size:11.5px}
.result-formula .hi{color:var(--accent)}.result-formula .hi2{color:var(--accent2)}.result-formula .hi3{color:var(--accent3)}
/* –ö–æ–Ω—Å–ø–µ–∫—Ç ‚Äî –±–ª–æ–∫ —Ñ–æ—Ä–º—É–ª –≤ —Å—Ç–∏–ª–µ –∑–∞–ø–∏—Å–∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è */
.ar-conspect{font-size:13px;line-height:1.7;color:var(--text)}
.ar-conspect .conc-title{font-weight:700;color:var(--accent);margin-bottom:6px;font-size:13px}
.ar-conspect .conc-formula{font-family:var(--mono);background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm);padding:10px 14px;margin:6px 0 12px;color:var(--accent2);white-space:nowrap;overflow-x:auto}
.ar-conspect .conc-example{margin:4px 0 0 12px;font-family:var(--mono);font-size:12px;color:var(--text-dim)}
.ar-conspect .conc-note{margin-top:14px;padding:10px 12px;background:rgba(107,127,215,.08);border-left:3px solid var(--accent);border-radius:0 8px 8px 0;font-size:12px;color:var(--text-dim);line-height:1.5}
.ar-conspect .conc-block{margin-bottom:18px}

/* TABS */
.tabs{display:flex;gap:4px;overflow-x:auto;margin-bottom:14px;-webkit-overflow-scrolling:touch;scrollbar-width:none}
.tabs::-webkit-scrollbar{display:none}
.tab-btn{flex-shrink:0;padding:8px 14px;font-family:var(--font);font-size:12px;font-weight:600;color:var(--text-dim);background:var(--surface2);border:1px solid var(--border);border-radius:20px;cursor:pointer;transition:all .15s;white-space:nowrap}
.tab-btn.active{background:var(--accent);color:#fff;border-color:transparent;}
.tab-pane{display:none}.tab-pane.active{display:block;animation:fadeUp .2s}

/* CHECKS */
.check-list{display:flex;flex-direction:column;gap:10px}
.check-item{border-radius:var(--radius-sm);padding:12px 14px;font-size:13px;line-height:1.5;display:flex;gap:10px;align-items:flex-start}
.check-pass{background:rgba(59,155,110,.12);border:1px solid rgba(59,155,110,.25)}
.check-fail{background:rgba(199,85,110,.12);border:1px solid rgba(199,85,110,.25)}
.check-neutral{background:rgba(107,127,215,.08);border:1px solid rgba(107,127,215,.2)}
.check-icon{font-size:16px;line-height:1.5;flex-shrink:0}
.check-item strong{color:var(--text-hi);display:block;margin-bottom:2px}

/* STEPS */
.steps{display:flex;flex-direction:column;gap:10px;counter-reset:s}
.step{background:var(--surface2);border:1px solid var(--border);border-radius:var(--radius-sm);padding:12px 12px 12px 48px;font-size:13px;line-height:1.55;position:relative;counter-increment:s}
.step::before{content:counter(s);position:absolute;left:12px;top:12px;width:24px;height:24px;background:var(--accent);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;font-family:var(--mono)}
.step-f{font-family:var(--mono);font-size:12px;color:var(--accent);margin-top:4px}

/* HISTOGRAM */
.hist-bars{display:flex;align-items:flex-end;gap:3px;height:90px}
.hb{flex:1;min-width:10px;background:var(--accent);border-radius:3px 3px 0 0;opacity:.8;transition:opacity .2s}
.hb:hover,.hb:active{opacity:1}
.hist-labels{display:flex;gap:3px;margin-top:4px}
.hl{flex:1;font-family:var(--mono);font-size:8px;color:var(--text-dim);text-align:center;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}

/* TABLE */
.tbl-wrap{overflow-x:auto;border-radius:var(--radius-sm)}
table.dt{width:100%;border-collapse:collapse;font-family:var(--mono);font-size:11.5px;white-space:nowrap}
table.dt th{background:var(--surface3);color:var(--accent);padding:9px 12px;text-align:left;font-weight:500;border-bottom:1px solid var(--border2)}
table.dt td{padding:8px 12px;border-bottom:1px solid var(--border);color:var(--text)}
table.dt tr:last-child td{border-bottom:none}
table.dt tr:hover td{background:rgba(107,127,215,.06)}
.td-hi{color:var(--accent)!important;font-weight:500}

/* SLIDER */
.slider-row{display:flex;align-items:center;gap:10px;margin-top:8px}
.slider-val{font-family:var(--mono);font-size:16px;font-weight:500;color:var(--accent);min-width:52px;text-align:right;flex-shrink:0}
input[type=range]{flex:1;-webkit-appearance:none;appearance:none;height:4px;background:var(--border2);border-radius:2px;outline:none;}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:22px;height:22px;border-radius:50%;background:var(--accent);cursor:pointer}

/* FORMULA */
.formula-card{background:var(--surface2);border:1px solid var(--border);border-radius:var(--radius-sm);padding:12px 14px;font-family:var(--mono);font-size:12px;color:var(--text-dim);line-height:2;margin-bottom:14px}
.fc-hi{color:var(--accent)}.fc-v{color:var(--accent2)}.fc-n{color:var(--gold)}

/* LIVE CALC */
.live-calc{background:var(--surface2);border:1px solid var(--border);border-radius:var(--radius);padding:14px 16px;margin-top:12px}
.live-row{display:flex;justify-content:space-between;align-items:baseline;padding:5px 0;border-bottom:1px solid var(--border);font-size:13px}
.live-row:last-child{border-bottom:none}
.live-k{color:var(--text-dim);font-size:12px}
.live-v{font-family:var(--mono);font-size:15px;color:var(--accent);font-weight:500}
.live-v.p{color:var(--accent2)}.live-v.g{color:var(--green)}

/* PROB */
.prob-big{text-align:center;padding:8px 0 12px}
.prob-num{font-family:var(--mono);font-size:46px;font-weight:500;color:var(--accent);line-height:1}
.prob-sub{font-family:var(--mono);font-size:12px;color:var(--text-dim);margin-top:4px}

/* GUIDE */
.guide-item{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm);padding:14px;margin-bottom:10px}
.guide-item-title{font-size:13px;font-weight:700;color:var(--accent);margin-bottom:8px}

/* LAPLACE */
#laplace-table th,#laplace-table td{font-size:10px;padding:6px 8px}

/* BOTTOM NAV */
.bottom-nav{flex-shrink:0;position:fixed;bottom:0;left:0;right:0;height:calc(var(--nav-h) + var(--safe));background:rgba(24,24,30,.96);border-top:1px solid var(--border);display:flex;align-items:stretch;padding-bottom:var(--safe);z-index:200;backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px)}
.nav-btn{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;cursor:pointer;transition:all .15s;padding:8px 2px;border:none;background:none;position:relative}
.nav-btn::before{content:‚Äô‚Äô;position:absolute;top:0;left:50%;transform:translateX(-50%);width:0;height:2px;background:linear-gradient(90deg,var(--accent),var(--accent2));border-radius:0 0 2px 2px;transition:width .2s}
.nav-btn.active::before{width:32px}
.nav-icon{width:30px;height:30px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:16px;transition:all .15s;background:transparent}
.nav-btn.ico-residuals .nav-icon{color:#3b9b6e}
.nav-btn.ico-leveling .nav-icon{color:#e6b422}
.nav-btn.ico-theodolite .nav-icon{color:#c7556e}
.nav-btn.ico-tasks .nav-icon{color:#6b7fd7}
.nav-btn.ico-guide .nav-icon{color:#fff}
.nav-btn.active .nav-icon{background:rgba(255,255,255,.08)}
.nav-label{font-size:9.5px;font-weight:600;color:#fff;letter-spacing:.3px;transition:opacity .15s}
.nav-btn:not(.active) .nav-label{opacity:.85}

/* LANDSCAPE */
@media(orientation:landscape)and(max-height:500px){header{height:48px}.logo-gem{width:28px;height:28px}.logo-name{font-size:17px}.page{padding:10px 12px}.page-title{font-size:19px}.bottom-nav{height:calc(50px + var(--safe))}.nav-label{display:none}:root{--nav-h:50px}}

/* DESKTOP */
@media(min-width:600px){body{align-items:center}.bottom-nav{max-width:560px;left:50%;transform:translateX(-50%);border-radius:20px 20px 0 0;border:1px solid var(--border);border-bottom:none}.app{max-width:560px;width:100%}header{max-width:560px;width:100%;align-self:center}}
</style>

</head>
<body>

<header>
  <div class="logo">
    <div class="logo-gem">
      <svg viewBox="0 0 24 24" fill="none">
        <path d="M12 2L20 9L16 22H8L4 9Z" stroke="white" stroke-width="1.8" fill="rgba(255,255,255,.15)"/>
        <path d="M4 9H20M8 9L12 2L16 9" stroke="white" stroke-width="1.2" opacity=".7"/>
      </svg>
    </div>
    <div>
      <div class="logo-name">Geo<span>Calculator</span></div>
      <div class="logo-sub">–ì–ï–û–î–ï–ó–ò–Ø</div>
    </div>
  </div>
  <div class="header-pill">v 3.0</div>
</header>

<div class="app">

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PAGE: –ù–ï–í–Ø–ó–ö–ò ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

  <div class="page active" id="page-residuals">
    <div class="page-head">
      <div class="page-title">–£–≥–ª–æ–≤—ã–µ <em>–Ω–µ–≤—è–∑–∫–∏</em></div>
      <div class="page-desc">–°–ö–ü, –æ—Ü–µ–Ω–∫–∞ —Ç–æ—á–Ω–æ—Å—Ç–∏, –ø—Ä–µ–¥–µ–ª—å–Ω–∞—è –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å</div>
    </div>
    <div class="card">
      <div class="card-title"><span class="ct-icon">‚ñ≥</span>–î–∞–Ω–Ω—ã–µ</div>
      <div class="tabs" style="margin-bottom:12px">
        <button class="tab-btn active" id="ar-tab-dms" onclick="switchArMode('dms',this)">¬∞ ‚Ä≤ ‚Ä≥</button>
        <button class="tab-btn" id="ar-tab-m" onclick="switchArMode('m',this)">–ú–µ—Ç—Ä—ã (–º)</button>
      </div>
      <div class="tab-pane active" id="ar-pane-dms">
        <div class="info"><strong>–£–≥–ª—ã:</strong> <strong>–∑–∞–ø—è—Ç–∞—è</strong> ‚Äî —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –∏–∑–º–µ—Ä–µ–Ω–∏–π (—Å–∫–æ–ª—å–∫–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –º–µ–∂–¥—É –∑–∞–ø—è—Ç—ã–º–∏ ‚Äî —Å—Ç–æ–ª—å–∫–æ –∏–∑–º–µ—Ä–µ–Ω–∏–π). –ú–∏–Ω—É—Å: –æ–±—ã—á–Ω—ã–π –∏–ª–∏ —Ç–∏–ø–æ–≥—Ä–∞—Ñ—Å–∫–∏–π (‚àí) ‚Äî –ø—Ä–æ–≥—Ä–∞–º–º–∞ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç. –í–Ω—É—Ç—Ä–∏ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å –≥—Ä–∞–¥—É—Å—ã —Å –ø—Ä–æ–±–µ–ª–∞–º–∏: <strong>1 30 45</strong> = 1¬∞30‚Ä≤45‚Ä≥. –û–¥–Ω–æ —á–∏—Å–ª–æ = —Å–µ–∫—É–Ω–¥—ã; —Ç—Ä–∏ —á–∏—Å–ª–∞ —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª = ¬∞‚Ä≤‚Ä≥. –î—Ä–æ–±–Ω–∞—è —á–∞—Å—Ç—å ‚Äî —Ç–æ—á–∫–∞. –ù–µ –º–µ–Ω–µ–µ 2 –∏–∑–º–µ—Ä–µ–Ω–∏–π.</div>
        <div class="field">
          <label>–ù–µ–≤—è–∑–∫–∏ (—Å–µ–∫ –∏–ª–∏ ¬∞ ‚Ä≤ ‚Ä≥)</label>
          <textarea id="ar-input-dms" placeholder="1.02, -1.88, 0.41, 1 30 0, 0 0 1.5"></textarea>
        </div>
      </div>
      <div class="tab-pane" id="ar-pane-m">
        <div class="info"><strong>–ú–µ—Ç—Ä—ã:</strong> –ª–∏–Ω–µ–π–Ω—ã–µ –Ω–µ–≤—è–∑–∫–∏ –≤ <strong>–º–µ—Ç—Ä–∞—Ö</strong> (–º). –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ ‚Äî –ø—Ä–æ–±–µ–ª –∏–ª–∏ –∑–∞–ø—è—Ç–∞—è; –¥—Ä–æ–±–Ω–∞—è —á–∞—Å—Ç—å ‚Äî —Ç–æ—á–∫–∞ (1.09, 2.3). –ù–µ –º–µ–Ω–µ–µ 2 –∑–Ω–∞—á–µ–Ω–∏–π.</div>
        <div class="field">
          <label>–ù–µ–≤—è–∑–∫–∏ (–º)</label>
          <textarea id="ar-input-m" placeholder="0.002 -0.001 0.003 0.001 -0.002"></textarea>
        </div>
      </div>
      <div class="btn-row">
        <button class="btn btn-primary" onclick="calcAR()">‚ñ∂ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
        <button class="btn btn-outline" onclick="arExample()">‚Üì –ü—Ä–∏–º–µ—Ä</button>
      </div>
    </div>
    <div class="result hidden" id="ar-result">
      <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('ar',0,this)">–§–æ—Ä–º—É–ª–∞ –ë–µ—Å—Å–µ–ª—è</button>
        <button class="tab-btn" onclick="switchTab('ar',1,this)">–°–ö–ü –°–µ—Ä–∏–∏</button>
        <button class="tab-btn" onclick="switchTab('ar',2,this)">–°–≤–æ–π—Å—Ç–≤–∞</button>
        <button class="tab-btn" onclick="switchTab('ar',3,this)">–ì—Ä–∞—Ñ–∏–∫</button>
      </div>
      <div class="tab-pane active" id="ar-t0">
        <div class="result-grid" id="ar-main"></div>
        <div id="ar-annot-wrap" class="ar-annot-wrap"></div>
        <div class="result-sep"></div>
        <div class="steps" id="ar-steps"></div>
      </div>
      <div class="tab-pane" id="ar-t1">
        <div class="result-grid" id="ar-conspect-main"></div>
        <div id="ar-conspect-annot" class="ar-annot-wrap"></div>
        <div class="result-sep"></div>
        <div id="ar-conspect" class="ar-conspect"></div>
      </div>
      <div class="tab-pane" id="ar-t2"><div class="check-list" id="ar-checks"></div></div>
      <div class="tab-pane" id="ar-t3"><div id="ar-hist"></div></div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PAGE: –ù–ò–í–ï–õ–ò–†–û–í–ö–ê ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

  <div class="page" id="page-leveling">
    <div class="page-head">
      <div class="page-title">–ù–∏–≤–µ–ª–∏—Ä–Ω—ã–π <em>—Ö–æ–¥</em></div>
      <div class="page-desc">–ù–µ–≤—è–∑–∫–∞, –¥–æ–ø—É—Å–∫, —É—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ</div>
    </div>
    <div class="card">
      <div class="card-title"><span class="ct-icon">‚äü</span>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã</div>
      <div class="info"><strong>–ü–æ–¥—Å–∫–∞–∑–∫–∞:</strong> H_A –∏ H_B ‚Äî –≤ –º–µ—Ç—Ä–∞—Ö. –ü—Ä–µ–≤—ã—à–µ–Ω–∏—è h_i –∏ –¥–ª–∏–Ω—ã d_i ‚Äî —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏; —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ –º–µ–∂–¥—É —á–∏—Å–ª–∞–º–∏ –≤ —Å—Ç—Ä–æ–∫–µ: –ø—Ä–æ–±–µ–ª –∏–ª–∏ –∑–∞–ø—è—Ç–∞—è; –¥—Ä–æ–±–Ω–∞—è —á–∞—Å—Ç—å ‚Äî —Ç–æ—á–∫–∞.</div>
      <div class="field-row">
        <div class="field"><label>H_A (–º)</label><input type="number" id="lev-ha" value="100.000" step="0.001"></div>
        <div class="field"><label>H_B (–º)</label><input type="number" id="lev-hb" value="98.325" step="0.001"></div>
      </div>
      <div class="field">
        <label>–ö–ª–∞—Å—Å –Ω–∏–≤–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è</label>
        <select id="lev-cls">
          <option value="3">III –∫–ª–∞—Å—Å ‚Äî 5‚àöL –º–º</option>
          <option value="4" selected>IV –∫–ª–∞—Å—Å ‚Äî 10‚àöL –º–º</option>
          <option value="t">–¢–µ—Ö–Ω–∏—á. ‚Äî 50‚àöL –º–º</option>
        </select>
      </div>
      <div class="field">
        <label>–ü—Ä–µ–≤—ã—à–µ–Ω–∏—è h_i (–º) ‚Äî –∫–∞–∂–¥–æ–µ —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏</label>
        <textarea id="lev-h" placeholder="-0.312&#10;+0.548&#10;-0.271&#10;+0.390&#10;-0.030"></textarea>
      </div>
      <div class="field">
        <label>–î–ª–∏–Ω—ã —Å–µ–∫—Ü–∏–π d_i (–∫–º) ‚Äî –∫–∞–∂–¥–∞—è —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏</label>
        <textarea id="lev-d" placeholder="1.2&#10;0.8&#10;1.5&#10;1.1&#10;0.9" style="min-height:72px"></textarea>
      </div>
      <button class="btn btn-primary" onclick="calcLev()">‚ñ∂ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
    </div>
    <div class="result hidden" id="lev-result">
      <div class="result-grid" id="lev-main"></div>
      <div class="result-sep"></div>
      <div class="tbl-wrap" id="lev-tbl"></div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PAGE: –¢–ï–û–î–û–õ–ò–¢ ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

  <div class="page" id="page-theodolite">
    <div class="page-head">
      <div class="page-title">–¢–µ–æ–¥–æ–ª–∏—Ç–Ω—ã–π <em>—Ö–æ–¥</em></div>
      <div class="page-desc">–£–≥–ª–æ–≤–∞—è –∏ –ª–∏–Ω–µ–π–Ω–∞—è –Ω–µ–≤—è–∑–∫–∏, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã</div>
    </div>
    <div class="card">
      <div class="card-title"><span class="ct-icon">‚à†</span>–û–ø–æ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</div>
      <div class="info"><strong>–ü–æ–¥—Å–∫–∞–∑–∫–∞:</strong> –£–≥–ª—ã Œ≤ ‚Äî –ø—Ä–∞–≤—ã–µ, –≤ –≥—Ä–∞–¥—É—Å–∞—Ö. –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ ‚Äî –ø—Ä–æ–±–µ–ª –∏–ª–∏ –∑–∞–ø—è—Ç–∞—è; –¥—Ä–æ–±–Ω–∞—è —á–∞—Å—Ç—å ‚Äî —Ç–æ—á–∫–∞. –£–≥–ª—ã –∏ —Å—Ç–æ—Ä–æ–Ω—ã ‚Äî –ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Å—Ç—Ä–æ–∫—É, –≤ –ø–æ—Ä—è–¥–∫–µ —Ö–æ–¥–∞.</div>
      <div class="field-row">
        <div class="field"><label>Œ± –Ω–∞—á (¬∞)</label><input type="number" id="th-a0" value="62.5" step="0.01"></div>
        <div class="field"><label>Œ± –∫–æ–Ω (¬∞)</label><input type="number" id="th-an" value="124.75" step="0.01"></div>
      </div>
      <div class="field-row">
        <div class="field"><label>X –Ω–∞—á (–º)</label><input type="number" id="th-x0" value="1000.00" step="0.01"></div>
        <div class="field"><label>Y –Ω–∞—á (–º)</label><input type="number" id="th-y0" value="1000.00" step="0.01"></div>
      </div>
      <div class="field-row">
        <div class="field"><label>X –∫–æ–Ω (–º)</label><input type="number" id="th-xn" value="1248.55" step="0.01"></div>
        <div class="field"><label>Y –∫–æ–Ω (–º)</label><input type="number" id="th-yn" value="1352.80" step="0.01"></div>
      </div>
      <div class="field">
        <label>–ü—Ä–∞–≤—ã–µ —É–≥–ª—ã Œ≤ (¬∞) ‚Äî –∫–∞–∂–¥—ã–π —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏</label>
        <textarea id="th-ang" placeholder="178.32&#10;182.15&#10;175.48&#10;186.70&#10;177.90"></textarea>
      </div>
      <div class="field">
        <label>–°—Ç–æ—Ä–æ–Ω—ã d (–º) ‚Äî –∫–∞–∂–¥–∞—è —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏</label>
        <textarea id="th-sides" placeholder="125.40&#10;98.70&#10;143.20&#10;87.50&#10;112.80" style="min-height:72px"></textarea>
      </div>
      <button class="btn btn-primary" onclick="calcTh()">‚ñ∂ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
    </div>
    <div class="result hidden" id="th-result">
      <div class="result-grid" id="th-main"></div>
      <div class="result-sep"></div>
      <div class="tbl-wrap" id="th-tbl"></div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PAGE: –ó–ê–î–ê–ß–ò ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

  <div class="page" id="page-tasks">
    <div class="page-head">
      <div class="page-title"><em>–ì–µ–æ–¥–µ–∑–∏—á–µ—Å–∫–∏–µ</em> –∑–∞–¥–∞—á–∏</div>
      <div class="page-desc">–ü—Ä—è–º–∞—è, –æ–±—Ä–∞—Ç–Ω–∞—è, –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏, –≤–∑–≤–µ—à–µ–Ω–Ω—ã–µ</div>
    </div>
    <div class="tabs">
      <button class="tab-btn active" onclick="switchTab('tk',0,this)">–ü—Ä—è–º–∞—è</button>
      <button class="tab-btn" onclick="switchTab('tk',1,this)">–û–±—Ä–∞—Ç–Ω–∞—è</button>
      <button class="tab-btn" onclick="switchTab('tk',2,this)">–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏</button>
      <button class="tab-btn" onclick="switchTab('tk',3,this)">–í–∑–≤–µ—à–µ–Ω–Ω—ã–µ</button>
    </div>

<div class="tab-pane active" id="tk-t0">
  <div class="card">
    <div class="card-title"><span class="ct-icon">‚Üí</span>–ü—Ä—è–º–∞—è –∑–∞–¥–∞—á–∞</div>
    <div class="info"><strong>–ü–æ–¥—Å–∫–∞–∑–∫–∞:</strong> X‚ÇÅ, Y‚ÇÅ –∏ d –≤ <strong>–º–µ—Ç—Ä–∞—Ö</strong>. Œ± ‚Äî –¥–∏—Ä–µ–∫—Ü–∏–æ–Ω–Ω—ã–π —É–≥–æ–ª –≤ <strong>–≥—Ä–∞–¥—É—Å–∞—Ö</strong> (0‚Ä¶360¬∞).</div>
    <div class="formula-card">X‚ÇÇ = X‚ÇÅ + <span class="fc-hi">d¬∑cos(Œ±)</span><br>Y‚ÇÇ = Y‚ÇÅ + <span class="fc-hi">d¬∑sin(Œ±)</span></div>
    <div class="field-row">
      <div class="field"><label>X‚ÇÅ (–º)</label><input type="number" id="fx1" value="1000" step="0.01" oninput="calcFwd()"></div>
      <div class="field"><label>Y‚ÇÅ (–º)</label><input type="number" id="fy1" value="500" step="0.01" oninput="calcFwd()"></div>
    </div>
    <div class="field-row">
      <div class="field"><label>Œ± (¬∞)</label><input type="number" id="fa" value="45" step="0.01" min="0" max="360" oninput="calcFwd()"></div>
      <div class="field"><label>d (–º)</label><input type="number" id="fd" value="100" step="0.01" min="0" oninput="calcFwd()"></div>
    </div>
    <div class="live-calc">
      <div class="live-row"><span class="live-k">X‚ÇÇ</span><span class="live-v" id="fwd-x2">‚Äî</span></div>
      <div class="live-row"><span class="live-k">Y‚ÇÇ</span><span class="live-v p" id="fwd-y2">‚Äî</span></div>
    </div>
  </div>
</div>

<div class="tab-pane" id="tk-t1">
  <div class="card">
    <div class="card-title"><span class="ct-icon">‚Üê</span>–û–±—Ä–∞—Ç–Ω–∞—è –∑–∞–¥–∞—á–∞</div>
    <div class="info"><strong>–ü–æ–¥—Å–∫–∞–∑–∫–∞:</strong> –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ–±–µ–∏—Ö —Ç–æ—á–µ–∫ –≤ <strong>–º–µ—Ç—Ä–∞—Ö</strong>. –£–≥–æ–ª Œ± –≤—ã–≤–æ–¥–∏—Ç—Å—è –≤ –≥—Ä–∞–¥—É—Å–∞—Ö, –º–∏–Ω—É—Ç–∞—Ö –∏ —Å–µ–∫—É–Ω–¥–∞—Ö (¬∞‚Ä≤‚Ä≥), —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ d ‚Äî –≤ –º–µ—Ç—Ä–∞—Ö.</div>
    <div class="formula-card">r = atan(<span class="fc-v">ŒîY</span>/<span class="fc-n">ŒîX</span>)<br>d = ‚àö(ŒîX¬≤+ŒîY¬≤)</div>
    <div class="field-row">
      <div class="field"><label>X‚ÇÅ (–º)</label><input type="number" id="ix1" value="1000" step="0.01" oninput="calcInv()"></div>
      <div class="field"><label>Y‚ÇÅ (–º)</label><input type="number" id="iy1" value="500" step="0.01" oninput="calcInv()"></div>
    </div>
    <div class="field-row">
      <div class="field"><label>X‚ÇÇ (–º)</label><input type="number" id="ix2" value="1070.71" step="0.01" oninput="calcInv()"></div>
      <div class="field"><label>Y‚ÇÇ (–º)</label><input type="number" id="iy2" value="570.71" step="0.01" oninput="calcInv()"></div>
    </div>
    <div class="live-calc">
      <div class="live-row"><span class="live-k">–£–≥–æ–ª Œ±</span><span class="live-v" id="inv-a">‚Äî</span></div>
      <div class="live-row"><span class="live-k">–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ d</span><span class="live-v p" id="inv-d">‚Äî</span></div>
    </div>
  </div>
</div>

<div class="tab-pane" id="tk-t2">
  <div class="card">
    <div class="card-title"><span class="ct-icon">‚à´</span>P(|Œî| &lt; k¬∑œÉ)</div>
    <div class="info"><strong>–ü–æ–¥—Å–∫–∞–∑–∫–∞:</strong> k ‚Äî –∫—Ä–∞—Ç–Ω–æ—Å—Ç—å –°–ö–ü (–Ω–∞–ø—Ä–∏–º–µ—Ä 2 –∏–ª–∏ 3). –ù–∏–∂–µ: m (–°–ö–ü) –≤ <strong>—Å–µ–∫—É–Ω–¥–∞—Ö</strong> (‚Ä≥); Œî_–ø—Ä–µ–¥ = t¬∑m (t=2 –∏–ª–∏ t=3 –ø–æ –º–µ—Ç–æ–¥–∏—á–∫–µ).</div>
    <div class="field">
      <label>–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç k</label>
      <div class="slider-row">
        <input type="range" id="pb-kr" min="0.1" max="4" step="0.05" value="2" oninput="document.getElementById('pb-k').value=this.value;calcProb()">
        <div class="slider-val" id="pb-kv">2.00</div>
      </div>
      <input type="number" id="pb-k" value="2" step="0.05" min="0.1" max="5" style="margin-top:8px" oninput="document.getElementById('pb-kr').value=this.value;calcProb()">
    </div>
    <div class="prob-big">
      <div class="prob-num" id="pb-pct">95.45%</div>
      <div class="prob-sub">P(|Œî|&lt;k¬∑œÉ) &nbsp;|&nbsp; Œ¶(k) = <span id="pb-phi">0.4773</span></div>
    </div>
  </div>
  <div class="card">
    <div class="card-title"><span class="ct-icon">‚ä•</span>–ü—Ä–µ–¥–µ–ª—å–Ω–∞—è –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å</div>
    <div class="info"><strong>–§–æ—Ä–º—É–ª–∞:</strong> Œî_–ø—Ä = t¬∑m. –í –≥–µ–æ–¥–µ–∑–∏–∏ —á–∞—â–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç <strong>—É—Ç—Ä–æ–µ–Ω–Ω—É—é</strong> (t=3, ‚âà99.7%) –∏–ª–∏ <strong>—É–¥–≤–æ–µ–Ω–Ω—É—é</strong> (t=2, ‚âà95%) ‚Äî –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –º–µ—Ç–æ–¥–∏—á–∫–∏/–Ω–æ—Ä–º–∞—Ç–∏–≤–∞. –í—ã–±–µ—Ä–∏—Ç–µ –∫—Ä–∞—Ç–Ω–æ—Å—Ç—å t.</div>
    <div class="field-row">
      <div class="field"><label>m (–°–ö–ü, —Å–µ–∫)</label><input type="number" id="lm-s" value="1.0" step="0.01" oninput="calcLim()"></div>
      <div class="field"><label>–ö—Ä–∞—Ç–Ω–æ—Å—Ç—å t</label>
        <select id="lm-t" onchange="calcLim()">
          <option value="2">t=2 ‚Äî —É–¥–≤–æ–µ–Ω–Ω–∞—è (‚âà95%)</option>
          <option value="2.5">t=2.5 (‚âà99%)</option>
          <option value="3" selected>t=3 ‚Äî —É—Ç—Ä–æ–µ–Ω–Ω–∞—è (‚âà99.7%)</option>
        </select>
      </div>
    </div>
    <div class="live-calc">
      <div class="live-row"><span class="live-k">Œî_–ø—Ä–µ–¥ = t¬∑m</span><span class="live-v g" id="lm-res">¬±3.000‚Ä≥</span></div>
    </div>
  </div>
  <div class="card">
    <div class="card-title"><span class="ct-icon">‚â°</span>–¢–∞–±–ª–∏—Ü–∞ –õ–∞–ø–ª–∞—Å–∞ Œ¶(x)</div>
    <div class="tbl-wrap"><table class="dt" id="laplace-table"></table></div>
  </div>
</div>

<div class="tab-pane" id="tk-t3">
  <div class="card">
    <div class="card-title"><span class="ct-icon">‚öñ</span>–í–∑–≤–µ—à–µ–Ω–Ω—ã–µ –∏–∑–º–µ—Ä–µ–Ω–∏—è</div>
    <div class="info"><strong>–ü–æ–¥—Å–∫–∞–∑–∫–∞:</strong> –§–æ—Ä–º–∞—Ç: <strong>–∑–Ω–∞—á–µ–Ω–∏–µ ; –≤–µ—Å</strong> (–∏–ª–∏ –∑–∞–ø—è—Ç–∞—è/–ø—Ä–æ–±–µ–ª –º–µ–∂–¥—É –Ω–∏–º–∏). –î—Ä–æ–±–Ω–∞—è —á–∞—Å—Ç—å ‚Äî —Ç–æ—á–∫–∞ (100.325; 2 –∏–ª–∏ 100, 1).</div>
    <div class="field">
      <label>–ò–∑–º–µ—Ä–µ–Ω–∏—è –∏ –≤–µ—Å–∞</label>
      <textarea id="wt-in" placeholder="100.325; 1&#10;100; 2&#10;100.33; 3&#10;100.32; 4"></textarea>
    </div>
    <button class="btn btn-primary" onclick="calcWt()">‚ñ∂ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
  </div>
  <div class="result hidden" id="wt-result">
    <div class="result-grid" id="wt-main"></div>
    <div class="result-sep"></div>
    <div class="tbl-wrap" id="wt-tbl"></div>
    <div class="result-sep"></div>
    <div class="result-formula" id="wt-f"></div>
  </div>
</div>

  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PAGE: –°–ü–†–ê–í–û–ß–ù–ò–ö ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

  <div class="page" id="page-guide">
    <div class="page-head">
      <div class="page-title"><em>–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫</em> —Ñ–æ—Ä–º—É–ª</div>
      <div class="page-desc">–í—Å–µ –∫–ª—é—á–µ–≤—ã–µ —Ñ–æ—Ä–º—É–ª—ã –≥–µ–æ–¥–µ–∑–∏–∏</div>
    </div>
    <div class="guide-item">
      <div class="guide-item-title">üìê –°–ö–ü –ø—Ä–∏ –∏—Å—Ç–∏–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö</div>
      <div class="formula-card" style="margin-bottom:0">m = ‚àö(<span class="fc-v">[Œî¬≤]</span>/<span class="fc-n">n</span>)<br>m<sub>m</sub> = m/‚àö(<span class="fc-n">2n</span>)</div>
    </div>
    <div class="guide-item">
      <div class="guide-item-title">üìê –°–ö–ü –ø—Ä–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è—Ö –æ—Ç —Å—Ä–µ–¥–Ω–µ–≥–æ</div>
      <div class="formula-card" style="margin-bottom:0">m = ‚àö(<span class="fc-v">[v¬≤]</span>/(<span class="fc-n">n</span>‚àí1))</div>
    </div>
    <div class="guide-item">
      <div class="guide-item-title">üìê –ü—Ä–µ–¥–µ–ª—å–Ω–∞—è –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å</div>
      <div class="formula-card" style="margin-bottom:0">Œî<sub>–ø—Ä–µ–¥</sub> = <span class="fc-hi">t</span>¬∑m<br>t=2: P=95.45% | t=3: P=99.73%</div>
    </div>
    <div class="guide-item">
      <div class="guide-item-title">üìê –ù–∏–≤–µ–ª–∏—Ä–Ω—ã–π —Ö–æ–¥</div>
      <div class="formula-card" style="margin-bottom:0">f<sub>h</sub> = [h]‚àí(H<sub>B</sub>‚àíH<sub>A</sub>)<br>f<sub>–¥–æ–ø</sub> = <span class="fc-hi">10</span>¬∑‚àö<span class="fc-v">L</span> –º–º (IV) | <span class="fc-hi">5</span>¬∑‚àö<span class="fc-v">L</span> –º–º (III)<br>Œ¥h<sub>i</sub> = ‚àíf<sub>h</sub>¬∑d<sub>i</sub>/[d]</div>
    </div>
    <div class="guide-item">
      <div class="guide-item-title">üìê –¢–µ–æ–¥–æ–ª–∏—Ç–Ω—ã–π —Ö–æ–¥</div>
      <div class="formula-card" style="margin-bottom:0">f<sub>Œ≤</sub>=[Œ≤]‚àí(Œ±‚ÇÄ‚àíŒ±‚Çô+n¬∑180¬∞)<br>f<sub>–¥–æ–ø</sub>=1‚Ä≤¬∑‚àön &nbsp;|&nbsp; f<sub>s</sub>=‚àö(f<sub>x</sub>¬≤+f<sub>y</sub>¬≤)</div>
    </div>
    <div class="guide-item">
      <div class="guide-item-title">üìê –í–∑–≤–µ—à–µ–Ω–Ω—ã–µ –∏–∑–º–µ—Ä–µ–Ω–∏—è</div>
      <div class="formula-card" style="margin-bottom:0">xÃÑ=[p¬∑l]/[p]<br>Œº=‚àö([p¬∑v¬≤]/([p]‚àí1))<br>m<sub>xÃÑ</sub>=Œº/‚àö[p]</div>
    </div>
    <div class="guide-item">
      <div class="guide-item-title">üìê –ü—Ä—è–º–∞—è / –û–±—Ä–∞—Ç–Ω–∞—è –∑–∞–¥–∞—á–∏</div>
      <div class="formula-card" style="margin-bottom:0">ŒîX=d¬∑cos(Œ±), ŒîY=d¬∑sin(Œ±)<br>Œ±=atan2(ŒîY,ŒîX) ‚Üí –ø–æ —á–µ—Ç–≤–µ—Ä—Ç—è–º</div>
    </div>
  </div>

</div>

<!-- BOTTOM NAV -->

<nav class="bottom-nav">
  <button class="nav-btn ico-residuals active" onclick="goPage('residuals',this)">
    <div class="nav-icon">‚ñ≥</div><div class="nav-label">–ù–µ–≤—è–∑–∫–∏</div>
  </button>
  <button class="nav-btn ico-leveling" onclick="goPage('leveling',this)">
    <div class="nav-icon">‚äü</div><div class="nav-label">–ù–∏–≤–µ–ª–∏—Ä</div>
  </button>
  <button class="nav-btn ico-theodolite" onclick="goPage('theodolite',this)">
    <div class="nav-icon">‚à†</div><div class="nav-label">–¢–µ–æ–¥–æ–ª–∏—Ç</div>
  </button>
  <button class="nav-btn ico-tasks" onclick="goPage('tasks',this)">
    <div class="nav-icon">‚äï</div><div class="nav-label">–ó–∞–¥–∞—á–∏</div>
  </button>
  <button class="nav-btn ico-guide" onclick="goPage('guide',this)">
    <div class="nav-icon">‚â°</div><div class="nav-label">–§–æ—Ä–º—É–ª—ã</div>
  </button>
</nav>

<script>
// ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function goPage(id,btn){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('page-'+id).classList.add('active');
  btn.classList.add('active');
  document.querySelector('.app').scrollTop=0;
}

function switchTab(g,idx,btn){
  const allBtns=btn.parentElement.querySelectorAll('.tab-btn');
  const allPanes=document.querySelectorAll('[id^="'+g+'-t"]');
  allBtns.forEach(b=>b.classList.remove('active'));
  allPanes.forEach(p=>p.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById(g+'-t'+idx).classList.add('active');
}

// ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// –ü–∞—Ä—Å–∏–Ω–≥: —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ –º–µ–∂–¥—É –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ ‚Äî –ø—Ä–æ–±–µ–ª –∏–ª–∏ –∑–∞–ø—è—Ç–∞—è; –¥—Ä–æ–±–Ω–∞—è —á–∞—Å—Ç—å ‚Äî —Ç–æ—á–∫–∞. Unicode –º–∏–Ω—É—Å (‚àí) ‚Üí ASCII.
const pn = t=>{
  const norm = String(t).replace(/\u2212/g, '-');
  return norm.replace(/[,;\n\r\t]+/g,' ').trim().split(/\s+/).map(s=>{
    const x = s.trim();
    if(x==='') return NaN;
    const num = parseFloat(x);
    return isNaN(num) ? NaN : num;
  }).filter(v=>!isNaN(v));
};
const fn = (v,d=4)=>typeof v==='number'?v.toFixed(d):String(v);
const fs = (v,d=4)=>typeof v==='number'?(v>=0?'+':'')+v.toFixed(d):String(v);
// –£–º–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: —Ü–µ–ª—ã–µ –±–µ–∑ –¥—Ä–æ–±–Ω–æ–π —á–∞—Å—Ç–∏, –¥—Ä–æ–±–Ω—ã–µ ‚Äî –±–µ–∑ –ª–∏—à–Ω–∏—Ö –Ω—É–ª–µ–π
const fnSmart = (v,d=4)=> {
  if(typeof v!=='number'||isNaN(v)) return String(v);
  const r = Math.round(v*1e12)/1e12;
  if(Math.abs(r-Math.round(r))<1e-9) return String(Math.round(r));
  return r.toFixed(d).replace(/\.?0+$/,'');
};
const fsSmart = (v,d=4)=>typeof v==='number'?(v>=0?'+':'')+fnSmart(v,d):String(v);
const ri = (l,v,c='')=>`<div class="result-item"><div class="ri-label">${l}</div><div class="ri-val ${c}">${v}</div></div>`;

// ‚îÄ‚îÄ –£–ì–õ–û–í–´–ï –ù–ï–í–Ø–ó–ö–ò ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let arMode = 'dms'; // 'dms' | 'm'
function switchArMode(mode, btn){
  arMode = mode;
  document.querySelectorAll('#page-residuals .card .tabs .tab-btn').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('#page-residuals .card .tab-pane').forEach(p=>p.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById(mode==='dms'?'ar-pane-dms':'ar-pane-m').classList.add('active');
}
// –°–µ–∫—É–Ω–¥—ã ‚Üí –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ ¬∞‚Ä≤‚Ä≥ (–º–∏–Ω—É—Ç—ã –∏ —Å–µ–∫—É–Ω–¥—ã —Å—Ç—Ä–æ–≥–æ 0‚Äì59; –ø—Ä–∏ |totalSec|<60 ‚Äî 0¬∞0‚Ä≤X‚Ä≥). –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∑–Ω–∞–∫.
function secToDMS(totalSec){
  if(Math.abs(totalSec) < 60) return { d: 0, m: 0, s: totalSec };
  if(totalSec < 0){
    const absS = Math.floor(-totalSec);
    const d = -Math.ceil(absS / 3600);
    const rem = 3600 * Math.ceil(absS / 3600) - absS;
    const m = Math.floor(rem / 60);
    const s = rem % 60;
    return { d, m, s };
  }
  let s = Math.floor(totalSec);
  const d = Math.floor(s / 3600);
  s = s % 3600;
  const m = Math.floor(s / 60);
  s = s % 60;
  return { d, m, s };
}
// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ–∫—É–Ω–¥ –¥—É–≥–∏ –≤ —Å—Ç—Ä–æ–∫—É: –ø—Ä–∏ |totalSec|<60 ‚Äî —Ç–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥—ã; –∏–Ω–∞—á–µ ¬∞‚Ä≤‚Ä≥ (–º–∏–Ω—É—Ç—ã –∏ —Å–µ–∫—É–Ω–¥—ã —Å—Ç—Ä–æ–≥–æ 0‚Äì59)
function formatDMS(totalSec){
  if(typeof totalSec !== 'number' || !isFinite(totalSec)) return '‚Äî‚Ä≥';
  if(totalSec < 0) return '‚àí' + formatDMS(-totalSec);
  if(totalSec < 60) return totalSec + '‚Ä≥';
  const n = secToDMS(totalSec);
  let d = n.d, m = n.m, s = Math.round(n.s);
  if(s >= 60){ s = 0; m++; }
  if(s < 0){ s += 60; m--; }
  if(m >= 60){ m = 0; d++; }
  if(m < 0){ m += 60; d--; }
  m = Math.max(0, Math.min(59, m));
  s = Math.max(0, Math.min(59, s));
  if(d >= 360) d = d % 360;
  return d + '¬∞' + String(m).padStart(2,'0') + '‚Ä≤' + String(s).padStart(2,'0') + '‚Ä≥';
}
// –°–ö–ü –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ ‚Äî –¢–û–õ–¨–ö–û —Å–µ–∫—É–Ω–¥—ã (–Ω–∏–∫–æ–≥–¥–∞ –≤ –≥—Ä–∞–¥—É—Å–∞—Ö/DMS). –î–ª—è –º–µ—Ç—Ä–æ–≤ ‚Äî –≤ –º.
function formatSKP(value, isM){
  if(typeof value !== 'number' || !isFinite(value)) return '‚Äî';
  if(isM) return '¬±' + fnSmart(value, 5) + ' –º';
  return '¬±' + fnSmart(value, 4) + '‚Ä≥';
}
// –ü–∞—Ä—Å–∏–Ω–≥ —É–≥–ª–æ–≤—ã—Ö –Ω–µ–≤—è–∑–æ–∫: –∑–∞–ø—è—Ç–∞—è (–∏–ª–∏ –ø–µ—Ä–µ–≤–æ–¥ —Å—Ç—Ä–æ–∫–∏) ‚Äî —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –∏–∑–º–µ—Ä–µ–Ω–∏–π. –û–¥–Ω–æ –∏–∑–º–µ—Ä–µ–Ω–∏–µ = –æ–¥–∏–Ω —Ñ—Ä–∞–≥–º–µ–Ω—Ç –º–µ–∂–¥—É –∑–∞–ø—è—Ç—ã–º–∏. –í–Ω—É—Ç—Ä–∏ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ –ø—Ä–æ–±–µ–ª—ã –¥–æ–ø—É—Å—Ç–∏–º—ã (–≥—Ä–∞–¥—É—Å—ã ¬∞‚Ä≤‚Ä≥: 1 30 45). –¢–æ—á–∫–∞ ‚Äî –¥—Ä–æ–±–Ω–∞—è —á–∞—Å—Ç—å.
function pnDms(t){
  const out = [];
  // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è: –Ω–µ-ASCII –∑–∞–ø—è—Ç–∞—è (Ôºå) –∏ –º–∏–Ω—É—Å (‚àí) ‚Üí –æ–±—ã—á–Ω—ã–µ, —á—Ç–æ–±—ã –∑–∞–ø—è—Ç–∞—è –≤—Å–µ–≥–¥–∞ –¥–∞–≤–∞–ª–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ
  const norm = String(t)
    .replace(/\u2212/g, '-')           // Unicode minus ‚Üí ASCII minus (–∏–Ω–∞—á–µ parseFloat –¥–∞—ë—Ç NaN)
    .replace(/[\uFF0C\u060C\u3001]/g, ','); // –ø–æ–ª–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –∏ –¥—Ä. –∑–∞–ø—è—Ç—ã–µ ‚Üí ASCII –∑–∞–ø—è—Ç–∞—è
  const tokens = norm.replace(/\r\n?|\n/g, ',').split(',').map(s=>s.trim()).filter(Boolean);
  for(const token of tokens){
    const parts = token.split(/\s+/).map(s=>parseFloat(s)).filter(v=>!isNaN(v));
    if(parts.length === 0) continue;
    if(parts.length === 1) out.push(parts[0]);
    else if(parts.length === 2) out.push(parts[0] * 60 + parts[1]);
    else out.push(parts[0] * 3600 + parts[1] * 60 + parts[2]);
  }
  return out;
}
function arExample(){
  if(arMode==='dms'){
    document.getElementById('ar-input-dms').value=
      '1.02, 0.41, 0.02, -1.88, -1.44, -0.25, 0.12, 0.22, -1.05, 0.56, '+
      '-1.72, 1.29, -1.81, -0.08, -0.50, 1 30 0, 0 0 1.5, 0 1 0';
  } else {
    document.getElementById('ar-input-m').value=
      '0.002 -0.001 0.003 0.001 -0.002 0.0015 -0.0008 0.0022 -0.0011 0.0009';
  }
  calcAR();
}
function calcAR(){
  const isM = arMode==='m';
  const raw = isM ? document.getElementById('ar-input-m').value : document.getElementById('ar-input-dms').value;
  const v = (isM ? pn(raw) : pnDms(raw)).filter(x=>isFinite(x));
  if(v.length<2){alert('–í–≤–µ–¥–∏—Ç–µ —Ö–æ—Ç—è –±—ã 2 –∑–Ω–∞—á–µ–Ω–∏—è');return;}
  const n = v.length;
  // 1. –°—Ä–µ–¥–Ω–µ–µ
  const sum = v.reduce((a,b)=>a+b,0), avg = sum / n;
  // 2. –û—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –æ—Ç —Å—Ä–µ–¥–Ω–µ–≥–æ v_i = value - avg
  const deviations = v.map(x => x - avg);
  // 3. –°–ö–ü –ø–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è–º: m = ‚àö(Œ£(v_i¬≤) / (n ‚àí 1))
  const sumSqDeviations = deviations.reduce((a, vi) => a + vi * vi, 0);
  const m = Math.sqrt(sumSqDeviations / (n - 1));
  const mm = m / Math.sqrt(2 * n), dp = 3 * m;
  // –ü—É—Ç—å ¬´–∫–æ–Ω—Å–ø–µ–∫—Ç¬ª: m = ‚àö(Œ£Œî¬≤/n) –ø–æ —Å—ã—Ä—ã–º –Ω–µ–≤—è–∑–∫–∞–º (—Ç–µ –∂–µ –≤–≤–µ–¥—ë–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è)
  const sumSqRaw = v.reduce((a,x)=>a+x*x,0);
  const mConspect = Math.sqrt(sumSqRaw / n);
  const mmConspect = mConspect / Math.sqrt(2 * n);
  const dpConspect = 3 * mConspect;
  const posN = v.filter(x=>x>0).length, negN = v.filter(x=>x<0).length;
  const maxA = Math.max(...v.map(Math.abs));
  const out = v.filter(x=>Math.abs(x - avg) > dp).length;
  const u = isM ? ' –º' : '‚Ä≥';
  const uShort = isM ? '–º' : '—Å–µ–∫';
  const arFmt = (val,sgn)=>{
    if(isM) return (sgn&&val>=0?'+':'')+fnSmart(val,5)+' –º';
    if(Math.abs(val)<60) return (sgn&&val>=0?'+':'')+fnSmart(val,3)+'‚Ä≥';
    return (sgn&&val>=0?'+':'')+formatDMS(val);
  };

  document.getElementById('ar-main').innerHTML=
    ri('n –∏–∑–º–µ—Ä–µ–Ω–∏–π',n)+ri('–°–ö–ü m ('+uShort+')',formatSKP(m,isM))+ri('–¢–æ—á–Ω–æ—Å—Ç—å m_m',formatSKP(mm,isM),'p')+ri('m ¬± m_m',formatSKP(m,isM).replace('¬±','')+' ¬± '+formatSKP(mm,isM).replace('¬±',''),'g')+
    ri('Œî_–ø—Ä–µ–¥ = 3m',formatSKP(dp,isM),'o')+ri('Œ£f ('+uShort+')',arFmt(sum,1))+ri('–°—Ä–µ–¥–Ω–µ–µ',arFmt(avg,1),'p')+ri('–ú–∞–∫—Å |f|',arFmt(maxA,0));

  const annotItems = [
    { name: 'n –∏–∑–º–µ—Ä–µ–Ω–∏–π', val: n, formula: 'n ‚Äî —á–∏—Å–ª–æ –≤–≤–µ–¥—ë–Ω–Ω—ã—Ö –Ω–µ–≤—è–∑–æ–∫', why: '–ü–æ–¥—Å—á–∏—Ç–∞–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–Ω–∞—á–µ–Ω–∏–π –≤ –≤–∞—à–µ–º –≤–≤–æ–¥–µ.' },
    { name: '–°–ö–ü m', val: formatSKP(m,isM), formula: 'm = ‚àö(Œ£(v_i¬≤)/(n‚àí1)), v_i = f_i ‚àí fÃÑ', why: '–ü–æ –≥–µ–æ–¥–µ–∑–∏—á–µ—Å–∫–æ–π –º–µ—Ç–æ–¥–∏–∫–µ: —Å–Ω–∞—á–∞–ª–∞ —Å—Ä–µ–¥–Ω–µ–µ fÃÑ=[f]/n, –∑–∞—Ç–µ–º –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è v_i=f_i‚àífÃÑ, –∑–∞—Ç–µ–º –°–ö–ü –ø–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è–º m=‚àö([v¬≤]/(n‚àí1)). –°–ö–ü –≤—ã–≤–æ–¥–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–∏–ª–∏ –º), –Ω–∏–∫–æ–≥–¥–∞ –≤ –≥—Ä–∞–¥—É—Å–∞—Ö.' },
    { name: '–¢–æ—á–Ω–æ—Å—Ç—å m_m', val: formatSKP(mm,isM), formula: 'm_m = m/‚àö(2n)', why: '–û—Ü–µ–Ω–∫–∞ —Å—Ä–µ–¥–Ω–µ–π –∫–≤–∞–¥—Ä–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç–∏ —Å–∞–º–æ–π –°–ö–ü; —Ç–µ–º —Ç–æ—á–Ω–µ–µ, —á–µ–º –±–æ–ª—å—à–µ n. –¢–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥—ã (–∏–ª–∏ –º).' },
    { name: 'm ¬± m_m', val: formatSKP(m,isM).replace('¬±','')+' ¬± '+formatSKP(mm,isM).replace('¬±',''), formula: '–ò—Ç–æ–≥–æ–≤–∞—è –∑–∞–ø–∏—Å—å –°–ö–ü —Å –µ—ë —Ç–æ—á–Ω–æ—Å—Ç—å—é', why: '–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç –∫–∞–∫ m ¬± m_m. –°–ö–ü ‚Äî —Ç–æ–ª—å–∫–æ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–∏–ª–∏ –º).' },
    { name: 'Œî_–ø—Ä–µ–¥ = 3m', val: formatSKP(dp,isM), formula: 'Œî_–ø—Ä–µ–¥ = t¬∑m –ø—Ä–∏ t=3', why: '–ü—Ä–µ–¥–µ–ª—å–Ω–∞—è –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å (—É—Ç—Ä–æ–µ–Ω–Ω–∞—è –°–ö–ü); –ø—Ä–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ ‚âà99.7% –æ—à–∏–±–æ–∫ –≤–Ω—É—Ç—Ä–∏ ¬±3m. –¢–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥—ã (–∏–ª–∏ –º).' },
    { name: 'Œ£f', val: arFmt(sum,1), formula: '[f] = Œ£f_i', why: '–°—É–º–º–∞ –≤—Å–µ—Ö –Ω–µ–≤—è–∑–æ–∫; –¥–ª—è —Å–ª—É—á–∞–π–Ω—ã—Ö –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç–µ–π –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–ª–∏–∑–∫–∞ –∫ –Ω—É–ª—é.' },
    { name: '–°—Ä–µ–¥–Ω–µ–µ', val: arFmt(avg,1), formula: 'fÃÑ = [f]/n', why: '–°—Ä–µ–¥–Ω–µ–µ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–æ–µ –Ω–µ–≤—è–∑–æ–∫; –æ—Ç –Ω–µ–≥–æ —Å—á–∏—Ç–∞—é—Ç—Å—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è v_i. –ü—Ä–∏ —Å–∏–º–º–µ—Ç—Ä–∏–∏ –±–ª–∏–∑–∫–æ –∫ –Ω—É–ª—é.' },
    { name: '–ú–∞–∫—Å |f|', val: arFmt(maxA,0), formula: 'max|f_i|', why: '–ù–∞–∏–±–æ–ª—å—à–∞—è –ø–æ –º–æ–¥—É–ª—é –Ω–µ–≤—è–∑–∫–∞; –Ω–µ –¥–æ–ª–∂–Ω–∞ –ø—Ä–µ–≤—ã—à–∞—Ç—å Œî_–ø—Ä–µ–¥.' }
  ];
  document.getElementById('ar-annot-wrap').innerHTML = `
    <details>
      <summary>–ö–∞–∫ –ø–æ–ª—É—á–µ–Ω—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (—Ñ–æ—Ä–º—É–ª—ã –∏ –ø–æ—è—Å–Ω–µ–Ω–∏—è)</summary>
      <div class="ar-annot-list">
        ${annotItems.map(a=>`<div class="ar-annot-item"><strong>${a.name}</strong> ‚Üí ${typeof a.val==='number'?a.val:a.val}<div class="ar-annot-f">${a.formula}</div><div class="ar-annot-why">${a.why}</div></div>`).join('')}
      </div>
    </details>`;

  const c1=Math.abs(avg)<=2*m/Math.sqrt(n), c2=out===0, c3=Math.abs(posN-negN)<=1.5*Math.sqrt(n);
  document.getElementById('ar-checks').innerHTML=`
    <div class="check-item ${c1?'check-pass':'check-fail'}">
      <span class="check-icon">${c1?'‚úÖ':'‚ùå'}</span>
      <div><strong>–°–∏–º–º–µ—Ç—Ä–∏—è (–ú[Œî]‚âà0)</strong>–°—Ä–µ–¥–Ω–µ–µ = ${arFmt(avg,1)} ‚Äî ${c1?'–í–´–ü–û–õ–ù–Ø–ï–¢–°–Ø':'–ù–ï –í–´–ü–û–õ–ù–Ø–ï–¢–°–Ø'}</div>
    </div>
    <div class="check-item ${c2?'check-pass':'check-fail'}">
      <span class="check-icon">${c2?'‚úÖ':'‚ùå'}</span>
      <div><strong>–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ—Å—Ç—å</strong>Œî_–ø—Ä–µ–¥=${formatSKP(dp,isM)}; –≤—ã–±—Ä–æ—Å–æ–≤: ${out} ‚Äî ${c2?'–í–´–ü–û–õ–ù–Ø–ï–¢–°–Ø':'–ù–ï –í–´–ü–û–õ–ù–Ø–ï–¢–°–Ø'}</div>
    </div>
    <div class="check-item ${c3?'check-pass':'check-fail'}">
      <span class="check-icon">${c3?'‚úÖ':'‚ùå'}</span>
      <div><strong>–í–∑–∞–∏–º–Ω–æ–µ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ</strong>+:${posN} / ‚àí:${negN} ‚Äî ${c3?'–í–´–ü–û–õ–ù–Ø–ï–¢–°–Ø':'–ù–ï –í–´–ü–û–õ–ù–Ø–ï–¢–°–Ø'}</div>
    </div>
    <div class="check-item check-neutral">
      <span class="check-icon">‚ÑπÔ∏è</span>
      <div><strong>–í—ã–≤–æ–¥</strong>${(c1&&c2&&c3)?'–ü–æ–≥—Ä–µ—à–Ω–æ—Å—Ç–∏ —Å–ª—É—á–∞–π–Ω—ã–µ.':'–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è. –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–Ω–∞–ª–∏–∑.'}</div>
    </div>`;

  const lo=Math.min(...v),hi=Math.max(...v),bc=Math.max(5,Math.ceil(Math.sqrt(n))),bw=(hi-lo)/bc||1;
  const bins=new Array(bc).fill(0);
  v.forEach(x=>bins[Math.min(Math.floor((x-lo)/bw),bc-1)]++);
  const maxB=Math.max(...bins,1);
  document.getElementById('ar-hist').innerHTML=`
    <div style="font-family:var(--mono);font-size:11px;color:var(--text-dim);margin-bottom:8px">${bc} –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤, n=${n}</div>
    <div class="hist-bars">${bins.map(b=>`<div class="hb" style="height:${Math.max(4,Math.round(b/maxB*80))}px"></div>`).join('')}</div>
    <div class="hist-labels">${bins.map((_,i)=>`<div class="hl">${isM ? fnSmart(lo+i*bw,1) : arFmt(lo+i*bw,0)}</div>`).join('')}</div>
    <div style="margin-top:10px;font-family:var(--mono);font-size:11px;color:var(--text-dim)">
      <span style="color:var(--accent)">¬±m</span>=${formatSKP(m,isM)} &nbsp;<span style="color:var(--accent2)">3m</span>=${formatSKP(dp,isM)}</div>`;

  const sqUnit = isM ? '–º¬≤' : '–∫–≤.—Å–µ–∫';
  const sumV = deviations.reduce((a,b)=>a+b,0);
  const fList = v.length <= 12 ? v.map(x=>fnSmart(x,2)).join(', ') : v.slice(0,5).map(x=>fnSmart(x,2)).join(', ') + ', ‚Ä¶ ('+n+' –≤—Å–µ–≥–æ)';
  document.getElementById('ar-steps').innerHTML=`
    <div class="step"><strong>1. –†–∞–∑–±–æ—Ä –≤–≤–æ–¥–∞</strong> ‚Äî –≥–¥–µ –º–æ–∂–µ—Ç ¬´—Å—ä–µ—Ö–∞—Ç—å¬ª: –∫–∞–∂–¥–æ–µ —á–∏—Å–ª–æ –º–µ–∂–¥—É –∑–∞–ø—è—Ç—ã–º–∏ = –æ–¥–Ω–æ –∏–∑–º–µ—Ä–µ–Ω–∏–µ; –º–∏–Ω—É—Å ¬´‚àí¬ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–±—ã—á–Ω—ã–π (ASCII).<div class="step-f">–†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ n = <strong>${n}</strong> –Ω–µ–≤—è–∑–æ–∫: ${fList} ${uShort}</div></div>
    <div class="step"><strong>2. –°—É–º–º–∞ –∏ —Å—Ä–µ–¥–Ω–µ–µ</strong><div class="step-f">[f] = Œ£f_i = ${fnSmart(sum,4)} &nbsp;‚Üí&nbsp; fÃÑ = [f]/n = ${fnSmart(sum,4)}/${n} = ${arFmt(avg,1)}</div></div>
    <div class="step"><strong>3. –û—Ç–∫–ª–æ–Ω–µ–Ω–∏—è</strong> v_i = f_i ‚àí fÃÑ (–æ—Ç –∫–∞–∂–¥–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –æ—Ç–Ω–∏–º–∞–µ–º —Å—Ä–µ–¥–Ω–µ–µ).<div class="step-f">[v¬≤] = Œ£(v_i¬≤) = ${fnSmart(sumSqDeviations,4)} ${sqUnit}</div></div>
    <div class="step"><strong>4. –ö–æ–Ω—Ç—Ä–æ–ª—å</strong> Œ£v_i –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 0 (—Å–ª–µ–¥—Å—Ç–≤–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è v_i).<div class="step-f">Œ£v_i = ${fnSmart(sumV,10)} ${sumV===0?'‚úì':' (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–≤–æ–¥)'}</div></div>
    <div class="step"><strong>5. –°–ö–ü –ø–æ –ë–µ—Å—Å–µ–ª—é</strong> m = ‚àö([v¬≤]/(n‚àí1)) ‚Äî —Ç–æ–ª—å–∫–æ –ø–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è–º, –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å (n‚àí1).<div class="step-f">m = ‚àö(${fnSmart(sumSqDeviations,4)}/${n-1}) = ‚àö(${fnSmart(sumSqDeviations/(n-1),6)}) = ${formatSKP(m,isM)}</div></div>
    <div class="step"><strong>6. –¢–æ—á–Ω–æ—Å—Ç—å –°–ö–ü –∏ –ø—Ä–µ–¥–µ–ª</strong><div class="step-f">m_m = m/‚àö(2n) = ${formatSKP(mm,isM)} &nbsp;|&nbsp; Œî_–ø—Ä–µ–¥ = 3m = ${formatSKP(dp,isM)}</div></div>
    <div class="step">–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–π—Å—Ç–≤<div class="step-f">–°–∏–º–º–µ—Ç—Ä–∏—è ${c1?'‚úì':'‚úó'} | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ—Å—Ç—å ${c2?'‚úì':'‚úó'} | –£–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ ${c3?'‚úì':'‚úó'}</div></div>`;

  // –í–∫–ª–∞–¥–∫–∞ ¬´–°–ö–ü –°–µ—Ä–∏–∏¬ª ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ —Ñ–æ—Ä–º—É–ª–∞–º –∫–æ–Ω—Å–ø–µ–∫—Ç–∞ (m = ‚àö(Œ£Œî¬≤/n))
  document.getElementById('ar-conspect-main').innerHTML=
    ri('n –∏–∑–º–µ—Ä–µ–Ω–∏–π',n)+ri('–°–ö–ü m ('+uShort+')',formatSKP(mConspect,isM))+ri('–¢–æ—á–Ω–æ—Å—Ç—å m_m',formatSKP(mmConspect,isM),'p')+ri('m ¬± m_m',formatSKP(mConspect,isM).replace('¬±','')+' ¬± '+formatSKP(mmConspect,isM).replace('¬±',''),'g')+
    ri('Œî_–ø—Ä–µ–¥ = 3m',formatSKP(dpConspect,isM),'o')+ri('Œ£Œî¬≤ ('+sqUnit+')',fnSmart(sumSqRaw,4))+ri('Œ£f ('+uShort+')',arFmt(sum,1))+ri('–ú–∞–∫—Å |f|',arFmt(maxA,0));

  const annotSeries = [
    { name: 'n –∏–∑–º–µ—Ä–µ–Ω–∏–π', formula: 'n ‚Äî —á–∏—Å–ª–æ –Ω–µ–≤—è–∑–æ–∫ (–æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ, —á—Ç–æ –≤–æ –≤–∫–ª–∞–¥–∫–µ ¬´–§–æ—Ä–º—É–ª–∞ –ë–µ—Å—Å–µ–ª—è¬ª).', why: '–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–µ –∂–µ –≤–≤–µ–¥—ë–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.' },
    { name: '–°–ö–ü m', formula: 'm = ‚àö(Œ£Œî¬≤ / n), –≥–¥–µ Œ£Œî¬≤ = Œ£(f_i¬≤) ‚Äî —Å—É–º–º–∞ –∫–≤–∞–¥—Ä–∞—Ç–æ–≤ –Ω–µ–≤—è–∑–æ–∫ –±–µ–∑ –≤—ã—á–∏—Ç–∞–Ω–∏—è —Å—Ä–µ–¥–Ω–µ–≥–æ.', why: '–ü–æ –∫–æ–Ω—Å–ø–µ–∫—Ç—É: –°–ö–ü –ø—Ä–∞–≤–∫–∏ –æ–¥–Ω–æ–≥–æ –∏–∑–º–µ—Ä–µ–Ω–∏—è. –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–æ–ª—å–∫–æ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–∏–ª–∏ –º).' },
    { name: '–¢–æ—á–Ω–æ—Å—Ç—å m_m', formula: 'm_m = m / ‚àö(2n)', why: '–°–ö–ü —Å–∞–º–æ–π –°–ö–ü (–æ—Ü–µ–Ω–∫–∏).' },
    { name: 'Œî_–ø—Ä–µ–¥ = 3m', formula: '–ü—Ä–µ–¥–µ–ª—å–Ω–∞—è –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å; –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–µ–≤—è–∑–∫–∞ –¥–æ —ç—Ç–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è.', why: '–£—Ç—Ä–æ–µ–Ω–Ω–∞—è –°–ö–ü.' },
    { name: 'Œ£Œî¬≤', formula: 'Œ£(f_i¬≤) ‚Äî —Å—É–º–º–∞ –∫–≤–∞–¥—Ä–∞—Ç–æ–≤ –≤–≤–µ–¥—ë–Ω–Ω—ã—Ö –Ω–µ–≤—è–∑–æ–∫.', why: '–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª–µ –ø–æ–¥ –∫–æ—Ä–Ω–µ–º –¥–ª—è m.' }
  ];
  document.getElementById('ar-conspect-annot').innerHTML=`
    <details>
      <summary>–ö–∞–∫ –ø–æ–ª—É—á–µ–Ω—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (–°–ö–ü —Å–µ—Ä–∏–∏)</summary>
      <div class="ar-annot-list">
        ${annotSeries.map(a=>`<div class="ar-annot-item"><strong>${a.name}</strong><div class="ar-annot-f">${a.formula}</div><div class="ar-annot-why">${a.why}</div></div>`).join('')}
      </div>
    </details>`;

  // –®–∞–≥–∏ —Ä–µ—à–µ–Ω–∏—è –ø–æ —Ñ–æ—Ä–º—É–ª–∞–º –∫–æ–Ω—Å–ø–µ–∫—Ç–∞
  const fListConc = v.length <= 10 ? v.map(x=>arFmt(x,1)).join(', ') : v.slice(0,4).map(x=>arFmt(x,1)).join(', ') + ', ‚Ä¶ ('+n+' –≤—Å–µ–≥–æ)';
  document.getElementById('ar-conspect').innerHTML=`
    <div style="font-size:12px;font-weight:700;color:var(--accent);margin-bottom:10px">–®–∞–≥–∏ –ø–æ —Ñ–æ—Ä–º—É–ª–∞–º –∫–æ–Ω—Å–ø–µ–∫—Ç–∞ (–°–ö–ü —Å–µ—Ä–∏–∏)</div>
    <div class="conc-block">
      <div class="conc-title">1. –î–∞–Ω–Ω—ã–µ (–≤–∞—à–∏ –Ω–µ–≤—è–∑–∫–∏)</div>
      <div class="conc-formula">n = ${n} &nbsp;|&nbsp; f_i: ${fListConc}</div>
    </div>
    <div class="conc-block">
      <div class="conc-title">2. –°–ö–ü –ø—Ä–∞–≤–∫–∏ (–æ–¥–Ω–æ–≥–æ –∏–∑–º–µ—Ä–µ–Ω–∏—è)</div>
      <div class="conc-formula">m = ‚àö(Œ£Œî¬≤ / n)</div>
      <div class="conc-example">Œ£Œî¬≤ = Œ£(f_i¬≤) = ${fnSmart(sumSqRaw,4)} ${sqUnit} &nbsp;‚Üí&nbsp; m = ‚àö(${fnSmart(sumSqRaw,4)} / ${n}) = ‚àö(${fnSmart(sumSqRaw/n,6)}) = ${formatSKP(mConspect,isM)}</div>
    </div>
    <div class="conc-block">
      <div class="conc-title">3. –°–ö–ü —Å–∞–º–æ–π –°–ö–ü (–°–ö–ü –æ—Ü–µ–Ω–∫–∏)</div>
      <div class="conc-formula">m_m = m / ‚àö(2n)</div>
      <div class="conc-example">m_m = ${formatSKP(mConspect,isM).replace('¬±','')} / ‚àö(${2*n}) = ${formatSKP(mmConspect,isM)}</div>
    </div>
    <div class="conc-block">
      <div class="conc-title">4. –ü—Ä–µ–¥–µ–ª—å–Ω–∞—è –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å</div>
      <div class="conc-formula">Œî_–ø—Ä–µ–¥ = 3 ¬∑ m</div>
      <div class="conc-example">Œî_–ø—Ä–µ–¥ = 3 √ó ${formatSKP(mConspect,isM).replace('¬±','')} = ${formatSKP(dpConspect,isM)} ‚Äî –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–µ–≤—è–∑–∫–∞ –¥–æ —ç—Ç–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è.</div>
    </div>
    <div class="conc-note">
      <strong>–î–≤–∞ –ø—É—Ç–∏:</strong> –∑–¥–µ—Å—å ‚Äî –°–ö–ü —Å–µ—Ä–∏–∏ (m = ‚àö(Œ£Œî¬≤/n)). –í–æ –≤–∫–ª–∞–¥–∫–µ <strong>–§–æ—Ä–º—É–ª–∞ –ë–µ—Å—Å–µ–ª—è</strong> ‚Äî m = ‚àö([v¬≤]/(n‚àí1)) –ø–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è–º –æ—Ç —Å—Ä–µ–¥–Ω–µ–≥–æ. –û–±–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –≤–≤–µ–¥—ë–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.
    </div>`;

  document.getElementById('ar-result').classList.remove('hidden');
}

// ‚îÄ‚îÄ –ù–ò–í–ï–õ–ò–†–ù–´–ô –•–û–î ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function calcLev(){
  const HA=+document.getElementById('lev-ha').value, HB=+document.getElementById('lev-hb').value;
  const hv=pn(document.getElementById('lev-h').value);
  let dv=pn(document.getElementById('lev-d').value);
  const cls=document.getElementById('lev-cls').value;
  if(!hv.length){alert('–í–≤–µ–¥–∏—Ç–µ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è');return;}
  if(dv.length!==hv.length)dv=new Array(hv.length).fill(1);
  const sumH=hv.reduce((a,b)=>a+b,0), sumD=dv.reduce((a,b)=>a+b,0);
  if(!sumD || !isFinite(sumD)){alert('–°—É–º–º–∞ –¥–ª–∏–Ω —Å–µ–∫—Ü–∏–π –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–π');return;}
  const fh=sumH-(HB-HA), k=cls==='3'?5:cls==='4'?10:50, fdop=k*Math.sqrt(sumD);
  const ok=Math.abs(fh*1000)<=fdop;
  const corr=dv.map(d=>-fh*d/sumD), adjH=hv.map((h,i)=>h+corr[i]);

  document.getElementById('lev-main').innerHTML=
    ri('Œ£h',fnSmart(sumH,4)+' –º')+ri('H_B‚àíH_A',fnSmart(HB-HA,4)+' –º')+
    ri('–ù–µ–≤—è–∑–∫–∞ f_h',fnSmart(fh*1000,1)+' –º–º',Math.abs(fh*1000)>fdop?'r':'')+
    ri('–î–æ–ø—É—Å–∫ ¬±'+k+'‚àöL','¬±'+fnSmart(fdop,1)+' –º–º','o')+
    ri('–û—Ü–µ–Ω–∫–∞',ok?'‚úì –ù–û–†–ú–ê':'‚úó –ü–†–ï–í–´–®–ï–ù',ok?'g':'r')+
    ri('Œ£ –¥–ª–∏–Ω',fnSmart(sumD,3)+' –∫–º');

  let rows='',H=HA;
  rows+=`<tr><td class="td-hi">A</td><td>‚Äî</td><td>‚Äî</td><td>‚Äî</td><td class="td-hi">${fnSmart(HA,4)}</td></tr>`;
  adjH.forEach((h,i)=>{H+=h;rows+=`<tr><td>${i+1}</td><td>${fsSmart(hv[i],4)}</td><td>${fnSmart(corr[i]*1000,1)} –º–º</td><td>${fsSmart(h,4)}</td><td class="td-hi">${fnSmart(H,4)}</td></tr>`;});
  document.getElementById('lev-tbl').innerHTML=`<table class="dt"><thead><tr><th>–¢—á</th><th>h_i</th><th>–ü–æ–ø—Ä.</th><th>h_–∏—Å–ø</th><th>H (–º)</th></tr></thead><tbody>${rows}</tbody></table>`;
  document.getElementById('lev-result').classList.remove('hidden');
}

// ‚îÄ‚îÄ –¢–ï–û–î–û–õ–ò–¢–ù–´–ô –•–û–î ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function calcTh(){
  const a0=+document.getElementById('th-a0').value, an=+document.getElementById('th-an').value;
  const x0=+document.getElementById('th-x0').value, y0=+document.getElementById('th-y0').value;
  const xn=+document.getElementById('th-xn').value, yn=+document.getElementById('th-yn').value;
  const ang=pn(document.getElementById('th-ang').value), sid=pn(document.getElementById('th-sides').value);
  if(!ang.length||!sid.length){alert('–í–≤–µ–¥–∏—Ç–µ —É–≥–ª—ã –∏ —Å—Ç–æ—Ä–æ–Ω—ã');return;}
  const n=ang.length, sumB=ang.reduce((a,b)=>a+b,0), thSum=a0-an+n*180, fbDeg=sumB-thSum, fdop=Math.sqrt(n), fb=fbDeg*60;
  const dBDeg=-fbDeg/n, adjA=ang.map(a=>a+dBDeg), alphas=[a0];
  adjA.forEach(b=>{let a=alphas[alphas.length-1]-b+180;while(a<0)a+=360;while(a>=360)a-=360;alphas.push(a);});
  const R=Math.PI/180, dX=sid.map((d,i)=>d*Math.cos(alphas[i]*R)), dY=sid.map((d,i)=>d*Math.sin(alphas[i]*R));
  const sumD=sid.reduce((a,b)=>a+b,0), fx=dX.reduce((a,b)=>a+b,0)-(xn-x0), fy=dY.reduce((a,b)=>a+b,0)-(yn-y0);
  if(!sumD || !isFinite(sumD)){alert('–°—É–º–º–∞ —Å—Ç–æ—Ä–æ–Ω –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–π');return;}
  const fss=Math.sqrt(fx*fx+fy*fy), T=fss/sumD;
  const cx=sid.map(d=>-fx*d/sumD), cy=sid.map(d=>-fy*d/sumD);

  const fbStr = formatDMS(fb * 60);
  document.getElementById('th-main').innerHTML=
    ri('f_Œ≤',fbStr,Math.abs(fb)>fdop?'r':'')+ri('–î–æ–ø—É—Å–∫ ¬±1‚Ä≤‚àön','¬±'+fnSmart(fdop,2)+'‚Ä≤')+
    ri('–£–≥–ª. –Ω–µ–≤—è–∑–∫–∞',Math.abs(fb)<=fdop?'‚úì –ù–û–†–ú–ê':'‚úó –ü–†–ï–í–´–®–ï–ù',Math.abs(fb)<=fdop?'g':'r')+
    ri('f_s (–º)',fnSmart(fss,4),'o')+ri('1/T',Math.round(1/T),'g')+ri('Œ£ –¥–ª–∏–Ω',fnSmart(sumD,3)+' –º');

  let rows='',cx2=x0,cy2=y0;
  rows+=`<tr><td class="td-hi">–ù</td><td>‚Äî</td><td>‚Äî</td><td>‚Äî</td><td class="td-hi">${fnSmart(x0,3)}</td><td class="td-hi">${fnSmart(y0,3)}</td></tr>`;
  sid.forEach((_,i)=>{cx2+=dX[i]+cx[i];cy2+=dY[i]+cy[i];rows+=`<tr><td>${i+1}</td><td>${fnSmart(alphas[i],2)}¬∞</td><td>${fnSmart(sid[i],2)}</td><td>${fsSmart(dX[i]+cx[i],3)}</td><td class="td-hi">${fnSmart(cx2,3)}</td><td class="td-hi">${fnSmart(cy2,3)}</td></tr>`;});
  document.getElementById('th-tbl').innerHTML=`<table class="dt"><thead><tr><th>–¢—á</th><th>Œ±(¬∞)</th><th>d(–º)</th><th>ŒîX</th><th>X</th><th>Y</th></tr></thead><tbody>${rows}</tbody></table>`;
  document.getElementById('th-result').classList.remove('hidden');
}

// ‚îÄ‚îÄ –ü–†–Ø–ú–ê–Ø / –û–ë–†–ê–¢–ù–ê–Ø ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function calcFwd(){
  const x1=+document.getElementById('fx1').value||0, y1=+document.getElementById('fy1').value||0;
  const a=+document.getElementById('fa').value||0, d=+document.getElementById('fd').value||0;
  const r=a*Math.PI/180;
  document.getElementById('fwd-x2').textContent=fn(x1+d*Math.cos(r),4)+' –º';
  document.getElementById('fwd-y2').textContent=fn(y1+d*Math.sin(r),4)+' –º';
}
function calcInv(){
  const x1=+document.getElementById('ix1').value||0, y1=+document.getElementById('iy1').value||0;
  const x2=+document.getElementById('ix2').value||0, y2=+document.getElementById('iy2').value||0;
  const dx=x2-x1, dy=y2-y1, dist=Math.sqrt(dx*dx+dy*dy);
  let al=Math.atan2(dy,dx)*180/Math.PI; if(al<0)al+=360;
  let totalSec=Math.round(al*3600);
  if(totalSec>=360*3600) totalSec=0;
  document.getElementById('inv-a').textContent=formatDMS(totalSec);
  document.getElementById('inv-d').textContent=fn(dist,4)+' –º';
}

// ‚îÄ‚îÄ –í–ï–†–û–Ø–¢–ù–û–°–¢–ò ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function phi(x){const t=x/Math.sqrt(2);let s=0,tm=t,sg=1;for(let k=0;k<80;k++){s+=sg*tm/(2*k+1);tm*=t*t/(k+1);sg*=-1;}return s/Math.sqrt(Math.PI/2)*0.5;}
function calcProb(){
  const k=parseFloat(document.getElementById('pb-k').value)||2;
  document.getElementById('pb-kv').textContent=fn(k,2);
  const p=2*phi(k);
  document.getElementById('pb-pct').textContent=fn(p*100,2)+'%';
  document.getElementById('pb-phi').textContent=fn(p/2,4);
}
function calcLim(){
  const s=parseFloat(document.getElementById('lm-s').value)||1, t=parseFloat(document.getElementById('lm-t').value)||3;
  document.getElementById('lm-res').textContent='¬±'+fnSmart(t*s,3)+'‚Ä≥';
}

// ‚îÄ‚îÄ –í–ó–í–ï–®–ï–ù–ù–´–ï ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function calcWt(){
  const lines=document.getElementById('wt-in').value.trim().split('\n');
  const data=lines.map(l=>{const p=l.replace(/[;,\s]+/g,' ').trim().split(/\s+/);return{l:parseFloat(p[0]),p:parseFloat(p[1])||1};}).filter(d=>!isNaN(d.l));
  if(data.length<2){alert('–í–≤–µ–¥–∏—Ç–µ —Ö–æ—Ç—è –±—ã 2 —Å—Ç—Ä–æ–∫–∏');return;}
  const sp=data.reduce((a,d)=>a+d.p,0), spl=data.reduce((a,d)=>a+d.p*d.l,0);
  if(!sp||!isFinite(sp)||sp<=1){alert('–°—É–º–º–∞ –≤–µ—Å–æ–≤ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ 1 (–¥–ª—è –æ—Ü–µ–Ω–∫–∏ –°–ö–ü)');return;}
  const mean=spl/sp;
  const v=data.map(d=>d.l-mean), spv2=data.reduce((a,d,i)=>a+d.p*v[i]*v[i],0);
  const mu=Math.sqrt(spv2/(sp-1)), mx=mu/Math.sqrt(sp);

  document.getElementById('wt-main').innerHTML=
    ri('–í–∑–≤–µ—à. —Å—Ä–µ–¥–Ω—è—è',fnSmart(mean,5))+ri('[p]',fnSmart(sp,2))+
    ri('Œº (–µ–¥. –≤–µ—Å–∞)','¬±'+fnSmart(mu,5),'p')+ri('m_xÃÑ','¬±'+fnSmart(mx,5),'g')+
    ri('Œî_–ø—Ä–µ–¥','¬±'+fnSmart(3*mx,5),'o');

  let rows='';
  data.forEach((d,i)=>rows+=`<tr><td>${fnSmart(d.l,5)}</td><td>${fnSmart(d.p,2)}</td><td>${fsSmart(v[i],5)}</td><td>${fnSmart(d.p*v[i]*v[i],6)}</td></tr>`);
  rows+=`<tr><td>Œ£</td><td class="td-hi">${fnSmart(sp,2)}</td><td>‚Äî</td><td class="td-hi">${fnSmart(spv2,6)}</td></tr>`;
  document.getElementById('wt-tbl').innerHTML=`<table class="dt"><thead><tr><th>l_i</th><th>p_i</th><th>v_i</th><th>p¬∑v¬≤</th></tr></thead><tbody>${rows}</tbody></table>`;
  document.getElementById('wt-f').innerHTML=`<span class="hi">xÃÑ</span>=${fnSmart(spl,4)}/${fnSmart(sp,2)}=${fnSmart(mean,5)}<br><span class="hi2">Œº</span>=‚àö(${fnSmart(spv2,4)}/${fnSmart(sp-1,2)})=¬±${fnSmart(mu,5)}<br><span class="hi">m_xÃÑ</span>=¬±${fnSmart(mx,5)}`;
  document.getElementById('wt-result').classList.remove('hidden');
}

// ‚îÄ‚îÄ –¢–ê–ë–õ–ò–¶–ê –õ–ê–ü–õ–ê–°–ê ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function buildLaplace(){
  let h='<thead><tr><th>x</th>';
  for(let d=0;d<=9;d++)h+=`<th>.0${d}</th>`;
  h+='</tr></thead><tbody>';
  for(let xi=0;xi<=30;xi++){
    const x0=xi/10; h+=`<tr><td class="td-hi">${fn(x0,1)}</td>`;
    for(let d=0;d<=9;d++)h+=`<td>${fn(phi(x0+d/100),4)}</td>`;
    h+='</tr>';
  }
  document.getElementById('laplace-table').innerHTML=h+'</tbody>';
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
window.onload=()=>{buildLaplace();calcProb();calcLim();calcFwd();calcInv();};
</script>

</body>
</html>